var SelectionJS;(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};(()=>{function n(e){const t=window.getSelection();if(!t)return;t.removeAllRanges();const n=document.createRange();n.selectNodeContents(e),n.collapse(!1),t.addRange(n)}e.d(t,{default:()=>s});class i{static getOptions(){return this.options}static configure(e={}){this.options=e,this.init()}static use(e){this.middleware.push(e)}static init(){this.initialized||(this.initialized=!0,document.addEventListener("mouseup",i.processSelection),document.addEventListener("touchend",i.processSelection))}static processSelection(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout((()=>{i.executeSelectionProcessing()}),200)}static executeSelectionProcessing(){const e=document.activeElement;let t=null;if(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName){const e=function(){const e=window.getSelection();if(!e||0===e.rangeCount)return null;const t=e.getRangeAt(0),n=e.toString().trim();return n?{text:n,range:t}:null}();if(!e||!e.text)return;let{text:n,range:s}=e;if(n=i.applyMiddleware(n),!i.isInsideContainer(s))return;t={text:n,range:s,modify:e=>i.handleModification(s,e)}}else{const n=e,s=n.selectionStart||0,o=n.selectionEnd||0;let r=n.value.substring(s,o).trim();if(!r)return;if(r=i.applyMiddleware(r),!i.isInsideContainer(n))return;t={text:r,range:null,modify:e=>i.handleModification(n,e)}}t&&i.triggerEvent("select",t)}static applyMiddleware(e){for(const t of i.middleware)e=t(e);return e}static isInsideContainer(e){if(!i.options.container)return!0;return(Array.isArray(i.options.container)?i.options.container:[i.options.container]).some((t=>e instanceof Range?function(e,t){const n=e.commonAncestorContainer;return Array.isArray(t)?t.some((e=>e.contains(n))):t.contains(n)}(e,t):function(e,t){return Array.isArray(t)?t.some((t=>t.contains(e))):t.contains(e)}(e,t)))}static handleModification(e,t){let s=i.applyMiddleware(t.text);if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)!function(e,t){const n=e.selectionStart||0,s=e.selectionEnd||0,o=e.value,r=o.substring(n,s);if("replace"===t.action)e.value=o.substring(0,n)+t.text+o.substring(s),e.selectionStart=e.selectionEnd=n+t.text.length;else if("append"===t.action)e.value=o.substring(0,s)+t.text+o.substring(s),e.selectionStart=e.selectionEnd=s+t.text.length;else if("prepend"===t.action)e.value=o.substring(0,n)+t.text+o.substring(n),e.selectionStart=e.selectionEnd=n+t.text.length;else if("wrap"===t.action){const a=i.getOptions().wrapperPlaceholder||"$";if(!t.text.includes(a))return void console.warn(`Wrapper template "${t.text}" does not include the placeholder "${a}".`);const c=t.text.replace(a,r);e.value=o.substring(0,n)+c+o.substring(s),e.selectionStart=n,e.selectionEnd=n+c.length}}(e,Object.assign(Object.assign({},t),{text:s})),i.triggerEvent("update",{text:e.value,range:null,modify:i.modify});else{!function(e,t){if(!t.text)return;const{action:s,text:o}=t,r=i.getOptions().wrapperPlaceholder||"$";let a;if("wrap"===s&&o)if(o.includes(r)){const t=e.extractContents().textContent||"",n=o.replace(r,t),i=document.createElement("div");if(i.innerHTML=n,1===i.childNodes.length)a=i.firstChild;else for(a=document.createDocumentFragment();i.firstChild;)a.appendChild(i.firstChild)}else console.warn(`Wrapper template "${o}" does not include the placeholder "${r}".`),a=document.createTextNode(o);else a=document.createTextNode(o);"wrap"===s?(e.deleteContents(),e.insertNode(a),n(a)):"append"===s?(e.collapse(!1),e.insertNode(a),n(a)):"prepend"===s?(e.collapse(!0),e.insertNode(a),function(e){const t=window.getSelection();if(!t)return;t.removeAllRanges();const n=document.createRange();n.selectNodeContents(e),n.collapse(!0),t.addRange(n)}(a)):"replace"===s&&(e.deleteContents(),e.insertNode(a),n(a));null===(c=window.getSelection())||void 0===c||c.removeAllRanges();var c}(e,Object.assign(Object.assign({},t),{text:s}));const o=function(e){const t=document.createElement("div");return t.appendChild(e.cloneContents()),t.textContent||""}(e);i.triggerEvent("update",{text:o,range:e,modify:i.modify})}}static on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}static off(e,t){const n=this.eventListeners.get(e);n&&this.eventListeners.set(e,n.filter((e=>e!==t)))}static triggerEvent(e,t){var n;(null!==(n=this.eventListeners.get(e))&&void 0!==n?n:[]).forEach((e=>e(t)))}}i.eventListeners=new Map,i.middleware=[],i.initialized=!1,i.options={},i.debounceTimer=null,i.configure();const s=i})(),SelectionJS=t.default})();